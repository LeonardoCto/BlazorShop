@page "/products"
@inject IProductService productService;

@if(Products == null)
{
    <h3>Loading Products...</h3>
}else{
    <h3 class="mb-5"> Products </h3>

     @if(Products.Any())
    {
         var productsByCategory = from product in Products
                                                    group product by product.CategoryId into prodCatGroup
                                                    orderby prodCatGroup.Key
                                                    select prodCatGroup;

        @foreach(var prodGroup in productsByCategory)
        {
            <h4>@prodGroup.FirstOrDefault(pg => pg.CategoryId == prodGroup.Key).CategoryName</h4>
        <div class="row mt-3">
            <ShowProducts Products = "@prodGroup"></ShowProducts>
        </div>
        <hr class="mb-2"/>
        }

    }
}

@code{
    public IEnumerable<ProductDto>? Products {get; set;}

    protected override async Task OnInitializedAsync()
    {
        Products = await productService.GetAllItems();
    }
}